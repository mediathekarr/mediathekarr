services:
  rundfunkarr:
    build: .
    # image: rundfunkarr/rundfunkarr:latest  # Uncomment when using pre-built image
    container_name: rundfunkarr
    environment:
      - TZ=Europe/Berlin
      - TVDB_API_KEY=${TVDB_API_KEY}  # Required: Your TVDB API key
      - DOWNLOAD_FOLDER_PATH=/downloads
      - DOWNLOAD_FOLDER_PATH_MAPPING=/downloads/completed  # Path mapping for Sonarr/Radarr
      - DATABASE_URL=file:/app/prisma/data/rundfunkarr.db
    volumes:
      - ./data:/app/prisma/data          # Database persistence
      - ./downloads:/app/downloads        # Temporary download folder
    ports:
      - "6767:6767"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:6767/api/download?mode=version"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Radarr for testing movie integration
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./radarr-config:/config
      - ./downloads:/downloads
      - ./movies:/movies
    ports:
      - "7878:7878"
    restart: unless-stopped

  # Sonarr for testing TV show integration
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./sonarr-config:/config
      - ./downloads:/downloads
      - ./tv:/tv
    ports:
      - "8989:8989"
    restart: unless-stopped

  # Prowlarr indexer manager
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./prowlarr-config:/config
    ports:
      - "9696:9696"
    restart: unless-stopped
